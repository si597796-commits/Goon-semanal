<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Goon Semanal ‚úÖ</title>
  <!-- Firebase compat (v9) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,serif;background:#fcfcf9;color:#134252;padding:20px;min-height:100vh}
    .container{max-width:1200px;margin:0 auto}
    header{text-align:center;margin-bottom:30px}
    h1{font-size:28px;margin-bottom:8px}
    .status{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(33,128,141,.1);border:1px solid rgba(33,128,141,.25);border-radius:6px;font-size:13px;color:#208091;font-weight:500}
    .status.connected::before{content:'';width:8px;height:8px;background:#208091;border-radius:50%;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    .setup-section,.device{background:#fffffe;border:1px solid rgba(94,82,64,.2);border-radius:12px;padding:30px;margin-bottom:30px}
    .setup-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
    .form-group{margin-bottom:15px}
    label{display:block;font-size:12px;font-weight:600;color:#627c7d;margin-bottom:6px;text-transform:uppercase}
    input{width:100%;padding:10px 12px;border:1px solid rgba(94,82,64,.2);border-radius:8px;font-size:14px;background:#fffffe;transition:border-color .25s}
    input:focus{outline:none;border-color:#208091;box-shadow:0 0 0 3px rgba(33,128,141,.4)}
    button{padding:10px 18px;border:none;border-radius:999px;font-size:18px;font-weight:600;cursor:pointer;transition:all .25s;font-family:inherit;margin:0 5px}
    .btn-primary{background:#208091;color:#fcfcf9;width:100%;margin-top:15px;font-size:14px;border-radius:8px}
    .btn-primary:hover{background:#1d7480}
    .btn-inc{background:#27ae60;color:#fff}
    .btn-inc:hover{background:#219150;transform:scale(1.05)}
    .btn-dec{background:#e74c3c;color:#fff}
    .btn-dec:hover{background:#c0392b;transform:scale(1.05)}
    button:active{transform:scale(.96)}
    .devices-grid{display:grid;grid-template-columns:1fr 1fr;gap:30px}
    .device{text-align:center;box-shadow:0 1px 3px rgba(0,0,0,.04)}
    .device-label{font-size:12px;font-weight:600;color:#627c7d;text-transform:uppercase;letter-spacing:.05em;margin-bottom:20px}
    .counter-display{font-size:64px;font-weight:800;font-family:monospace;margin:20px 0;min-height:80px;display:flex;align-items:center;justify-content:center}
    .device1 .counter-display{color:#ff6b6b}
    .device2 .counter-display{color:#4ecdc4}
    .total-display{background:linear-gradient(135deg,#ff6b6b,#4ecdc4);color:#fff;border-radius:12px;padding:25px;text-align:center;grid-column:1/-1;margin-top:20px}
    .total-display h3{font-size:14px;margin-bottom:10px;text-transform:uppercase;opacity:.9}
    .total-number{font-size:48px;font-weight:800;font-family:monospace}
    .reset-info{background:rgba(255,107,107,.1);border:1px solid rgba(255,107,107,.3);border-radius:8px;padding:12px;font-size:12px;color:#627c7d;margin-top:15px}
    .info-box{background:rgba(33,128,141,.08);border:1px solid rgba(33,128,141,.2);border-radius:8px;padding:12px;font-size:12px;color:#627c7d}
    @media(max-width:768px){.devices-grid,.setup-grid{grid-template-columns:1fr}h1{font-size:24px}.counter-display{font-size:48px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéØ Goon Semanal</h1>
      <div class="status" id="status">‚óè Desconectado</div>
    </header>

    <div class="setup-section" id="setupSection">
      <h2>‚öôÔ∏è Firebase <span id="savedStatus"></span></h2>
      <div class="setup-grid">
        <div class="form-group">
          <label>API Key</label>
          <input id="apiKey" placeholder="AIza...">
        </div>
        <div class="form-group">
          <label>Database URL</label>
          <input id="databaseURL" placeholder="https://teu-projeto-default-rtdb.firebaseio.com/">
        </div>
        <div class="form-group">
          <label>Project ID</label>
          <input id="projectId" placeholder="teu-projeto">
        </div>
        <div class="form-group">
          <label>Auth Domain</label>
          <input id="authDomain" placeholder="teu-projeto.firebaseapp.com">
        </div>
      </div>
      <div class="info-box">Firebase Console ‚Üí ‚öôÔ∏è ‚Üí Chaves da Web</div>
      <button class="btn-primary" onclick="connectFirebase()" id="connectBtn">üîó Conectar & Salvar</button>
      <button class="btn-primary" onclick="clearSaved()" style="margin-top:10px;background:#ff6b6b;">üóëÔ∏è Limpar dados salvos</button>
    </div>

    <div class="devices-grid" id="devicesGrid" style="display:none;">
      <div class="device device1">
        <div class="device-label">üë¶ Bobinho</div>
        <div class="counter-display" id="counter1">0</div>
        <div>
          <button class="btn-dec" onclick="decrementCounter(1)">‚àí</button>
          <button class="btn-inc" onclick="incrementCounter(1)">+</button>
        </div>
        <div class="reset-info" id="resetInfo1">Reset: 7 dias</div>
      </div>

      <div class="device device2">
        <div class="device-label">üëß Bobinha</div>
        <div class="counter-display" id="counter2">0</div>
        <div>
          <button class="btn-dec" onclick="decrementCounter(2)">‚àí</button>
          <button class="btn-inc" onclick="incrementCounter(2)">+</button>
        </div>
        <div class="reset-info" id="resetInfo2">Reset: 7 dias</div>
      </div>

      <div class="total-display">
        <h3>Total Semanal</h3>
        <div class="total-number" id="totalCounter">0</div>
      </div>
    </div>
  </div>

  <script>
    let db, isConnected = false;
    let current = { bobinho: 0, bobinha: 0, total: 0 };

    // Carrega credenciais salvas
    window.onload = function () {
      const saved = localStorage.getItem('goonFirebase');
      if (saved) {
        const c = JSON.parse(saved);
        apiKey.value      = c.apiKey      || '';
        databaseURL.value = c.databaseURL || '';
        projectId.value   = c.projectId   || '';
        authDomain.value  = c.authDomain  || '';
        savedStatus.textContent = '(‚úÖ salvo)';
        connectBtn.textContent  = 'üöÄ Conectar';
      }
    };

    function connectFirebase() {
      const config = {
        apiKey: apiKey.value.trim(),
        databaseURL: databaseURL.value.trim(),
        projectId: projectId.value.trim(),
        authDomain: authDomain.value.trim()
      };

      if (!config.apiKey || !config.databaseURL) {
        alert('API Key + Database URL obrigat√≥rios!');
        return;
      }

      localStorage.setItem('goonFirebase', JSON.stringify(config));
      savedStatus.textContent = '(‚úÖ salvo)';

      connectBtn.textContent = 'üîÑ Conectando...';
      connectBtn.disabled = true;

      try {
        firebase.initializeApp(config);
        db = firebase.database();                               /* [web:75] */

        db.ref('.info/connected').on('value', (snap) => {       /* [web:75] */
          if (snap.val()) {
            isConnected = true;
            status.textContent = '‚óè Conectado ‚úÖ';
            status.className = 'status connected';
            setupSection.style.display = 'none';
            devicesGrid.style.display = 'grid';
            checkReset();
            startListener();
          } else {
            status.textContent = '‚óè Desconectado';
          }
        });
      } catch (e) {
        alert('Erro: ' + e.message);
        connectBtn.textContent = 'üîó Conectar & Salvar';
        connectBtn.disabled = false;
      }
    }

    function clearSaved() {
      localStorage.removeItem('goonFirebase');
      location.reload();
    }

    // Reset semanal
    function checkReset() {
      db.ref('meta/lastReset').once('value').then((snap) => {
        const now  = new Date();
        const last = snap.val();
        if (!last || (now - new Date(last)) / 86400000 >= 7) {
          db.ref('counters').set({ bobinho: 0, bobinha: 0, total: 0 });  /* [web:75] */
          db.ref('meta/lastReset').set(now.toISOString());
          resetInfo1.textContent = '‚úÖ Reset hoje';
          resetInfo2.textContent = '‚úÖ Reset hoje';
          setTimeout(() => {
            resetInfo1.textContent = 'Reset: 7 dias';
            resetInfo2.textContent = 'Reset: 7 dias';
          }, 3000);
        }
      });
    }

    // Listener em tempo real
    function startListener() {
      db.ref('counters').on('value', (snap) => {               /* [web:75] */
        const data = snap.val() || { bobinho: 0, bobinha: 0, total: 0 };
        current = data;
        counter1.textContent     = data.bobinho || 0;
        counter2.textContent     = data.bobinha || 0;
        totalCounter.textContent = data.total   || 0;
      });
    }

    // Incrementa
    function incrementCounter(device) {
      if (!isConnected) {
        alert('Conecte primeiro!');
        return;
      }

      const data = { ...current };
      if (device === 1) data.bobinho = (data.bobinho || 0) + 1;
      else              data.bobinha = (data.bobinha || 0) + 1;
      data.total = (data.bobinho || 0) + (data.bobinha || 0);

      db.ref('counters').set(data);                           /* [web:75][web:108] */
    }

    // Diminui at√© 0
    function decrementCounter(device) {
      if (!isConnected) {
        alert('Conecte primeiro!');
        return;
      }

      const data = { ...current };
      if (device === 1) {
        data.bobinho = Math.max(0, (data.bobinho || 0) - 1);
      } else {
        data.bobinha = Math.max(0, (data.bobinha || 0) - 1);
      }
      data.total = (data.bobinho || 0) + (data.bobinha || 0);

      db.ref('counters').set(data);                           /* [web:75][web:108] */
    }

    window.connectFirebase    = connectFirebase;
    window.incrementCounter   = incrementCounter;
    window.decrementCounter   = decrementCounter;
    window.clearSaved         = clearSaved;
  </script>
</body>
</html>





